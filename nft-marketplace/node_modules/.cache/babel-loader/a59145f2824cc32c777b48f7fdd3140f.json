{"ast":null,"code":"import _regeneratorRuntime from \"C:/a/nft-marketplace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";\nimport _asyncToGenerator from \"C:/a/nft-marketplace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";\nimport _slicedToArray from \"C:/a/nft-marketplace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nimport _toConsumableArray from \"C:/a/nft-marketplace/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\n\nvar _jsxFileName = \"C:\\\\a\\\\nft-marketplace\\\\src\\\\store\\\\CollectionProvider.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { useReducer } from 'react';\nimport CollectionContext from './collection-context';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar defaultCollectionState = {\n  contract: null,\n  totalSupply: null,\n  collection: [],\n  nftIsLoading: true\n};\n\nvar collectionReducer = function collectionReducer(state, action) {\n  if (action.type === 'CONTRACT') {\n    return {\n      contract: action.contract,\n      totalSupply: state.totalSupply,\n      collection: state.collection,\n      nftIsLoading: state.nftIsLoading\n    };\n  }\n\n  if (action.type === 'LOADSUPPLY') {\n    return {\n      contract: state.contract,\n      totalSupply: action.totalSupply,\n      collection: state.collection,\n      nftIsLoading: state.nftIsLoading\n    };\n  }\n\n  if (action.type === 'LOADCOLLECTION') {\n    return {\n      contract: state.contract,\n      totalSupply: state.totalSupply,\n      collection: action.collection,\n      nftIsLoading: state.nftIsLoading\n    };\n  }\n\n  if (action.type === 'UPDATECOLLECTION') {\n    var index = state.collection.findIndex(function (NFT) {\n      return NFT.id === parseInt(action.NFT.id);\n    });\n    var collection = [];\n\n    if (index === -1) {\n      collection = [action.NFT].concat(_toConsumableArray(state.collection));\n    } else {\n      collection = _toConsumableArray(state.collection);\n    }\n\n    return {\n      contract: state.contract,\n      totalSupply: state.totalSupply,\n      collection: collection,\n      nftIsLoading: state.nftIsLoading\n    };\n  }\n\n  if (action.type === 'UPDATEOWNER') {\n    var _index = state.collection.findIndex(function (NFT) {\n      return NFT.id === parseInt(action.id);\n    });\n\n    var _collection = _toConsumableArray(state.collection);\n\n    _collection[_index].owner = action.newOwner;\n    return {\n      contract: state.contract,\n      totalSupply: state.totalSupply,\n      collection: _collection,\n      nftIsLoading: state.nftIsLoading\n    };\n  }\n\n  if (action.type === 'LOADING') {\n    return {\n      contract: state.contract,\n      totalSupply: state.totalSupply,\n      collection: state.collection,\n      nftIsLoading: action.loading\n    };\n  }\n\n  return defaultCollectionState;\n};\n\nvar CollectionProvider = function CollectionProvider(props) {\n  _s();\n\n  var _useReducer = useReducer(collectionReducer, defaultCollectionState),\n      _useReducer2 = _slicedToArray(_useReducer, 2),\n      CollectionState = _useReducer2[0],\n      dispatchCollectionAction = _useReducer2[1];\n\n  var loadContractHandler = function loadContractHandler(web3, NFTCollection, deployedNetwork) {\n    var contract = deployedNetwork ? new web3.eth.Contract(NFTCollection.abi, deployedNetwork.address) : '';\n    dispatchCollectionAction({\n      type: 'CONTRACT',\n      contract: contract\n    });\n    return contract;\n  };\n\n  var loadTotalSupplyHandler = /*#__PURE__*/function () {\n    var _ref = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee(contract) {\n      var totalSupply;\n      return _regeneratorRuntime.wrap(function _callee$(_context) {\n        while (1) {\n          switch (_context.prev = _context.next) {\n            case 0:\n              _context.next = 2;\n              return contract.methods.totalSupply().call();\n\n            case 2:\n              totalSupply = _context.sent;\n              dispatchCollectionAction({\n                type: 'LOADSUPPLY',\n                totalSupply: totalSupply\n              });\n              return _context.abrupt(\"return\", totalSupply);\n\n            case 5:\n            case \"end\":\n              return _context.stop();\n          }\n        }\n      }, _callee);\n    }));\n\n    return function loadTotalSupplyHandler(_x) {\n      return _ref.apply(this, arguments);\n    };\n  }();\n\n  var loadCollectionHandler = /*#__PURE__*/function () {\n    var _ref2 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee2(contract, totalSupply) {\n      var collection, i, hash, response, metadata, owner;\n      return _regeneratorRuntime.wrap(function _callee2$(_context2) {\n        while (1) {\n          switch (_context2.prev = _context2.next) {\n            case 0:\n              collection = [];\n              i = 0;\n\n            case 2:\n              if (!(i < totalSupply)) {\n                _context2.next = 27;\n                break;\n              }\n\n              _context2.next = 5;\n              return contract.methods.tokenURIs(i).call();\n\n            case 5:\n              hash = _context2.sent;\n              _context2.prev = 6;\n              _context2.next = 9;\n              return fetch(\"https://ipfs.infura.io/ipfs/\".concat(hash, \"?clear\"));\n\n            case 9:\n              response = _context2.sent;\n\n              if (response.ok) {\n                _context2.next = 12;\n                break;\n              }\n\n              throw new Error('Something went wrong');\n\n            case 12:\n              _context2.next = 14;\n              return response.json();\n\n            case 14:\n              metadata = _context2.sent;\n              _context2.next = 17;\n              return contract.methods.ownerOf(i + 1).call();\n\n            case 17:\n              owner = _context2.sent;\n              collection = [{\n                id: i + 1,\n                title: metadata.properties.name.description,\n                img: metadata.properties.image.description,\n                owner: owner\n              }].concat(_toConsumableArray(collection));\n              _context2.next = 24;\n              break;\n\n            case 21:\n              _context2.prev = 21;\n              _context2.t0 = _context2[\"catch\"](6);\n              console.error('Something went wrong');\n\n            case 24:\n              i++;\n              _context2.next = 2;\n              break;\n\n            case 27:\n              dispatchCollectionAction({\n                type: 'LOADCOLLECTION',\n                collection: collection\n              });\n\n            case 28:\n            case \"end\":\n              return _context2.stop();\n          }\n        }\n      }, _callee2, null, [[6, 21]]);\n    }));\n\n    return function loadCollectionHandler(_x2, _x3) {\n      return _ref2.apply(this, arguments);\n    };\n  }();\n\n  var updateCollectionHandler = /*#__PURE__*/function () {\n    var _ref3 = _asyncToGenerator( /*#__PURE__*/_regeneratorRuntime.mark(function _callee3(contract, id, owner) {\n      var NFT, hash, response, metadata;\n      return _regeneratorRuntime.wrap(function _callee3$(_context3) {\n        while (1) {\n          switch (_context3.prev = _context3.next) {\n            case 0:\n              _context3.next = 2;\n              return contract.methods.tokenURI(id).call();\n\n            case 2:\n              hash = _context3.sent;\n              _context3.prev = 3;\n              _context3.next = 6;\n              return fetch(\"https://ipfs.infura.io/ipfs/\".concat(hash, \"?clear\"));\n\n            case 6:\n              response = _context3.sent;\n\n              if (response.ok) {\n                _context3.next = 9;\n                break;\n              }\n\n              throw new Error('Something went wrong');\n\n            case 9:\n              _context3.next = 11;\n              return response.json();\n\n            case 11:\n              metadata = _context3.sent;\n              NFT = {\n                id: parseInt(id),\n                title: metadata.properties.name.description,\n                img: metadata.properties.image.description,\n                owner: owner\n              };\n              _context3.next = 18;\n              break;\n\n            case 15:\n              _context3.prev = 15;\n              _context3.t0 = _context3[\"catch\"](3);\n              console.error('Something went wrong');\n\n            case 18:\n              dispatchCollectionAction({\n                type: 'UPDATECOLLECTION',\n                NFT: NFT\n              });\n\n            case 19:\n            case \"end\":\n              return _context3.stop();\n          }\n        }\n      }, _callee3, null, [[3, 15]]);\n    }));\n\n    return function updateCollectionHandler(_x4, _x5, _x6) {\n      return _ref3.apply(this, arguments);\n    };\n  }();\n\n  var updateOwnerHandler = function updateOwnerHandler(id, newOwner) {\n    dispatchCollectionAction({\n      type: 'UPDATEOWNER',\n      id: id,\n      newOwner: newOwner\n    });\n  };\n\n  var setNftIsLoadingHandler = function setNftIsLoadingHandler(loading) {\n    dispatchCollectionAction({\n      type: 'LOADING',\n      loading: loading\n    });\n  };\n\n  var collectionContext = {\n    contract: CollectionState.contract,\n    totalSupply: CollectionState.totalSupply,\n    collection: CollectionState.collection,\n    nftIsLoading: CollectionState.nftIsLoading,\n    loadContract: loadContractHandler,\n    loadTotalSupply: loadTotalSupplyHandler,\n    loadCollection: loadCollectionHandler,\n    updateCollection: updateCollectionHandler,\n    updateOwner: updateOwnerHandler,\n    setNftIsLoading: setNftIsLoadingHandler\n  };\n  return /*#__PURE__*/_jsxDEV(CollectionContext.Provider, {\n    value: collectionContext,\n    children: props.children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 169,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(CollectionProvider, \"ZbRmD8kAHPzijQQn9Hqowc3SWuI=\");\n\n_c = CollectionProvider;\nexport default CollectionProvider;\n\nvar _c;\n\n$RefreshReg$(_c, \"CollectionProvider\");","map":{"version":3,"sources":["C:/a/nft-marketplace/src/store/CollectionProvider.js"],"names":["useReducer","CollectionContext","defaultCollectionState","contract","totalSupply","collection","nftIsLoading","collectionReducer","state","action","type","index","findIndex","NFT","id","parseInt","owner","newOwner","loading","CollectionProvider","props","CollectionState","dispatchCollectionAction","loadContractHandler","web3","NFTCollection","deployedNetwork","eth","Contract","abi","address","loadTotalSupplyHandler","methods","call","loadCollectionHandler","i","tokenURIs","hash","fetch","response","ok","Error","json","metadata","ownerOf","title","properties","name","description","img","image","console","error","updateCollectionHandler","tokenURI","updateOwnerHandler","setNftIsLoadingHandler","collectionContext","loadContract","loadTotalSupply","loadCollection","updateCollection","updateOwner","setNftIsLoading","children"],"mappings":"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","sourcesContent":["import { useReducer } from 'react';\r\n\r\nimport CollectionContext from './collection-context';\r\n\r\nconst defaultCollectionState = {\r\n  contract: null,\r\n  totalSupply: null,\r\n  collection: [],\r\n  nftIsLoading: true\r\n};\r\n\r\nconst collectionReducer = (state, action) => {\r\n  if(action.type === 'CONTRACT') {    \r\n    return {\r\n      contract: action.contract,\r\n      totalSupply: state.totalSupply,\r\n      collection: state.collection,\r\n      nftIsLoading: state.nftIsLoading\r\n    };\r\n  } \r\n  \r\n  if(action.type === 'LOADSUPPLY') {\r\n    return {\r\n      contract: state.contract,\r\n      totalSupply: action.totalSupply,\r\n      collection: state.collection,\r\n      nftIsLoading: state.nftIsLoading\r\n    };\r\n  }\r\n\r\n  if(action.type === 'LOADCOLLECTION') {    \r\n    return {\r\n      contract: state.contract,\r\n      totalSupply: state.totalSupply,\r\n      collection: action.collection,\r\n      nftIsLoading: state.nftIsLoading\r\n    };\r\n  }\r\n\r\n  if(action.type === 'UPDATECOLLECTION') {    \r\n    const index = state.collection.findIndex(NFT => NFT.id === parseInt(action.NFT.id));\r\n    let collection = [];\r\n\r\n    if(index === -1) {\r\n      collection = [action.NFT, ...state.collection];\r\n    } else {\r\n      collection = [...state.collection];\r\n    }    \r\n\r\n    return {\r\n      contract: state.contract,\r\n      totalSupply: state.totalSupply,\r\n      collection: collection,\r\n      nftIsLoading: state.nftIsLoading\r\n    };\r\n  }\r\n\r\n  if(action.type === 'UPDATEOWNER') {\r\n    const index = state.collection.findIndex(NFT => NFT.id === parseInt(action.id));\r\n    let collection = [...state.collection];\r\n    collection[index].owner = action.newOwner;\r\n\r\n    return {\r\n      contract: state.contract,\r\n      totalSupply: state.totalSupply,\r\n      collection: collection,\r\n      nftIsLoading: state.nftIsLoading\r\n    };\r\n  }\r\n\r\n  if(action.type === 'LOADING') {    \r\n    return {\r\n      contract: state.contract,\r\n      totalSupply: state.totalSupply,\r\n      collection: state.collection,\r\n      nftIsLoading: action.loading\r\n    };\r\n  }\r\n  \r\n  return defaultCollectionState;\r\n};\r\n\r\nconst CollectionProvider = props => {\r\n  const [CollectionState, dispatchCollectionAction] = useReducer(collectionReducer, defaultCollectionState);\r\n  \r\n  const loadContractHandler = (web3, NFTCollection, deployedNetwork) => {\r\n    const contract = deployedNetwork ? new web3.eth.Contract(NFTCollection.abi, deployedNetwork.address): '';\r\n    dispatchCollectionAction({type: 'CONTRACT', contract: contract}); \r\n    return contract;\r\n  };\r\n\r\n  const loadTotalSupplyHandler = async(contract) => {\r\n    const totalSupply = await contract.methods.totalSupply().call();\r\n    dispatchCollectionAction({type: 'LOADSUPPLY', totalSupply: totalSupply});\r\n    return totalSupply;\r\n  };\r\n\r\n  const loadCollectionHandler = async(contract, totalSupply) => {\r\n    let collection = [];\r\n\r\n    for(let i = 0; i < totalSupply; i++) {\r\n      const hash = await contract.methods.tokenURIs(i).call();\r\n      try {\r\n        const response = await fetch(`https://ipfs.infura.io/ipfs/${hash}?clear`);\r\n        if(!response.ok) {\r\n          throw new Error('Something went wrong');\r\n        }\r\n\r\n        const metadata = await response.json();\r\n        const owner = await contract.methods.ownerOf(i + 1).call();\r\n\r\n        collection = [{\r\n          id: i + 1,\r\n          title: metadata.properties.name.description,\r\n          img: metadata.properties.image.description,\r\n          owner: owner\r\n        }, ...collection];\r\n      }catch {\r\n        console.error('Something went wrong');\r\n      }\r\n    }\r\n    dispatchCollectionAction({type: 'LOADCOLLECTION', collection: collection});     \r\n  };\r\n\r\n  const updateCollectionHandler = async(contract, id, owner) => {\r\n    let NFT;\r\n    const hash = await contract.methods.tokenURI(id).call();\r\n    try {\r\n      const response = await fetch(`https://ipfs.infura.io/ipfs/${hash}?clear`);\r\n      if(!response.ok) {\r\n        throw new Error('Something went wrong');      }\r\n\r\n      const metadata = await response.json();      \r\n\r\n      NFT = {\r\n        id: parseInt(id),\r\n        title: metadata.properties.name.description,\r\n        img: metadata.properties.image.description,\r\n        owner: owner\r\n      };\r\n    }catch {\r\n      console.error('Something went wrong');\r\n    }\r\n    dispatchCollectionAction({type: 'UPDATECOLLECTION', NFT: NFT});\r\n  };\r\n\r\n  const updateOwnerHandler = (id, newOwner) => {\r\n    dispatchCollectionAction({type: 'UPDATEOWNER', id: id, newOwner: newOwner});\r\n  };\r\n\r\n  const setNftIsLoadingHandler = (loading) => {\r\n    dispatchCollectionAction({type: 'LOADING', loading: loading});\r\n  };\r\n\r\n  const collectionContext = {\r\n    contract: CollectionState.contract,\r\n    totalSupply: CollectionState.totalSupply,\r\n    collection: CollectionState.collection,\r\n    nftIsLoading:CollectionState.nftIsLoading,\r\n    loadContract: loadContractHandler,\r\n    loadTotalSupply: loadTotalSupplyHandler,\r\n    loadCollection: loadCollectionHandler,\r\n    updateCollection: updateCollectionHandler,\r\n    updateOwner: updateOwnerHandler,\r\n    setNftIsLoading: setNftIsLoadingHandler\r\n  };\r\n  \r\n  return (\r\n    <CollectionContext.Provider value={collectionContext}>\r\n      {props.children}\r\n    </CollectionContext.Provider>\r\n  );\r\n};\r\n\r\nexport default CollectionProvider;"]},"metadata":{},"sourceType":"module"}
{"ast":null,"code":"var _jsxFileName = \"C:\\\\a\\\\nft-marketplace\\\\src\\\\components\\\\Content\\\\NFTCollection\\\\NFTCollection.js\",\n    _this = this,\n    _s = $RefreshSig$();\n\nimport { useContext, useRef, createRef } from 'react';\nimport web3 from '../../../connection/web3';\nimport Web3Context from '../../../store/web3-context';\nimport CollectionContext from '../../../store/collection-context';\nimport MarketplaceContext from '../../../store/marketplace-context';\nimport { formatPrice } from '../../../helpers/utils';\nimport eth from '../../../img/eth.png';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nvar NFTCollection = function NFTCollection() {\n  _s();\n\n  var web3Ctx = useContext(Web3Context);\n  var collectionCtx = useContext(CollectionContext);\n  var marketplaceCtx = useContext(MarketplaceContext);\n  var priceRefs = useRef([]);\n\n  if (priceRefs.current.length !== collectionCtx.collection.length) {\n    priceRefs.current = Array(collectionCtx.collection.length).fill().map(function (_, i) {\n      return priceRefs.current[i] || /*#__PURE__*/createRef();\n    });\n  }\n\n  var makeOfferHandler = function makeOfferHandler(event, id, key) {\n    event.preventDefault();\n    var enteredPrice = web3.utils.toWei(priceRefs.current[key].current.value, 'ether');\n    collectionCtx.contract.methods.approve(marketplaceCtx.contract.options.address, id).send({\n      from: web3Ctx.account\n    }).on('transactionHash', function (hash) {\n      marketplaceCtx.setMktIsLoading(true);\n    }).on('receipt', function (receipt) {\n      marketplaceCtx.contract.methods.makeOffer(id, enteredPrice).send({\n        from: web3Ctx.account\n      }).on('error', function (error) {\n        window.alert('Something went wrong when pushing to the blockchain');\n        marketplaceCtx.setMktIsLoading(false);\n      });\n    });\n  };\n\n  var buyHandler = function buyHandler(event) {\n    var buyIndex = parseInt(event.target.value);\n    marketplaceCtx.contract.methods.fillOffer(marketplaceCtx.offers[buyIndex].offerId).send({\n      from: web3Ctx.account,\n      value: marketplaceCtx.offers[buyIndex].price\n    }).on('transactionHash', function (hash) {\n      marketplaceCtx.setMktIsLoading(true);\n    }).on('error', function (error) {\n      window.alert('Something went wrong when pushing to the blockchain');\n      marketplaceCtx.setMktIsLoading(false);\n    });\n  };\n\n  var cancelHandler = function cancelHandler(event) {\n    var cancelIndex = parseInt(event.target.value);\n    marketplaceCtx.contract.methods.cancelOffer(marketplaceCtx.offers[cancelIndex].offerId).send({\n      from: web3Ctx.account\n    }).on('transactionHash', function (hash) {\n      marketplaceCtx.setMktIsLoading(true);\n    }).on('error', function (error) {\n      window.alert('Something went wrong when pushing to the blockchain');\n      marketplaceCtx.setMktIsLoading(false);\n    });\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: \"row text-center\",\n    children: collectionCtx.collection.map(function (NFT, key) {\n      var index = marketplaceCtx.offers ? marketplaceCtx.offers.findIndex(function (offer) {\n        return offer.id === NFT.id;\n      }) : -1;\n      var owner = index === -1 ? NFT.owner : marketplaceCtx.offers[index].user;\n      var price = index !== -1 ? formatPrice(marketplaceCtx.offers[index].price).toFixed(2) : null;\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-2 m-3 pb-3 card border-info\",\n        children: [/*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"card-body\",\n          children: /*#__PURE__*/_jsxDEV(\"h5\", {\n            className: \"card-title\",\n            children: NFT.title\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 72,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 71,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"img\", {\n          src: \"https://ipfs.infura.io/ipfs/\".concat(NFT.img),\n          className: \"card-img-bottom\",\n          alt: \"NFT \".concat(key)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 13\n        }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"fw-light fs-6\",\n          children: \"\".concat(owner.substr(0, 7), \"...\").concat(owner.substr(owner.length - 7))\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 13\n        }, _this), index !== -1 ? owner !== web3Ctx.account ? /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-grid gap-2 col-5 mx-auto\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: buyHandler,\n              value: index,\n              className: \"btn btn-success\",\n              children: \"BUY\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 80,\n              columnNumber: 21\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 79,\n            columnNumber: 19\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-7 d-flex justify-content-end\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: eth,\n              width: \"25\",\n              height: \"25\",\n              className: \"align-center float-start\",\n              alt: \"price icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 83,\n              columnNumber: 21\n            }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-start\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"\".concat(price)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 84,\n                columnNumber: 47\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 84,\n              columnNumber: 21\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 82,\n            columnNumber: 19\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 17\n        }, _this) : /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"row\",\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"d-grid gap-2 col-5 mx-auto\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              onClick: cancelHandler,\n              value: index,\n              className: \"btn btn-danger\",\n              children: \"CANCEL\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 89,\n              columnNumber: 21\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 88,\n            columnNumber: 19\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-7 d-flex justify-content-end\",\n            children: [/*#__PURE__*/_jsxDEV(\"img\", {\n              src: eth,\n              width: \"25\",\n              height: \"25\",\n              className: \"align-center float-start\",\n              alt: \"price icon\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 92,\n              columnNumber: 21\n            }, _this), /*#__PURE__*/_jsxDEV(\"p\", {\n              className: \"text-start\",\n              children: /*#__PURE__*/_jsxDEV(\"b\", {\n                children: \"\".concat(price)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 93,\n                columnNumber: 47\n              }, _this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 93,\n              columnNumber: 21\n            }, _this)]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 91,\n            columnNumber: 19\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 17\n        }, _this) : owner === web3Ctx.account ? /*#__PURE__*/_jsxDEV(\"form\", {\n          className: \"row g-2\",\n          onSubmit: function onSubmit(e) {\n            return makeOfferHandler(e, NFT.id, key);\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-5 d-grid gap-2\",\n            children: /*#__PURE__*/_jsxDEV(\"button\", {\n              type: \"submit\",\n              className: \"btn btn-secondary\",\n              children: \"OFFER\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 99,\n              columnNumber: 21\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 98,\n            columnNumber: 19\n          }, _this), /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"col-7\",\n            children: /*#__PURE__*/_jsxDEV(\"input\", {\n              type: \"number\",\n              step: \"0.01\",\n              placeholder: \"ETH...\",\n              className: \"form-control\",\n              ref: priceRefs.current[key]\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 102,\n              columnNumber: 21\n            }, _this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 101,\n            columnNumber: 19\n          }, _this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 97,\n          columnNumber: 17\n        }, _this) : /*#__PURE__*/_jsxDEV(\"p\", {\n          children: /*#__PURE__*/_jsxDEV(\"br\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 111,\n            columnNumber: 20\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 111,\n          columnNumber: 17\n        }, _this)]\n      }, key, true, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 11\n      }, _this);\n    })\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 5\n  }, _this);\n};\n\n_s(NFTCollection, \"PFaaIAkFNWm2sar3qDrkEDR8Cng=\");\n\n_c = NFTCollection;\nexport default NFTCollection;\n\nvar _c;\n\n$RefreshReg$(_c, \"NFTCollection\");","map":{"version":3,"sources":["C:/a/nft-marketplace/src/components/Content/NFTCollection/NFTCollection.js"],"names":["useContext","useRef","createRef","web3","Web3Context","CollectionContext","MarketplaceContext","formatPrice","eth","NFTCollection","web3Ctx","collectionCtx","marketplaceCtx","priceRefs","current","length","collection","Array","fill","map","_","i","makeOfferHandler","event","id","key","preventDefault","enteredPrice","utils","toWei","value","contract","methods","approve","options","address","send","from","account","on","hash","setMktIsLoading","receipt","makeOffer","error","window","alert","buyHandler","buyIndex","parseInt","target","fillOffer","offers","offerId","price","cancelHandler","cancelIndex","cancelOffer","NFT","index","findIndex","offer","owner","user","toFixed","title","img","substr","e"],"mappings":"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","sourcesContent":["import { useContext, useRef, createRef } from 'react';\r\n\r\nimport web3 from '../../../connection/web3';\r\nimport Web3Context from '../../../store/web3-context';\r\nimport CollectionContext from '../../../store/collection-context';\r\nimport MarketplaceContext from '../../../store/marketplace-context';\r\nimport { formatPrice } from '../../../helpers/utils';\r\nimport eth from '../../../img/eth.png';\r\n\r\nconst NFTCollection = () => {\r\n  const web3Ctx = useContext(Web3Context);\r\n  const collectionCtx = useContext(CollectionContext);\r\n  const marketplaceCtx = useContext(MarketplaceContext);\r\n\r\n  const priceRefs = useRef([]);\r\n  if (priceRefs.current.length !== collectionCtx.collection.length) {\r\n    priceRefs.current = Array(collectionCtx.collection.length).fill().map((_, i) => priceRefs.current[i] || createRef());\r\n  }\r\n  \r\n  const makeOfferHandler = (event, id, key) => {\r\n    event.preventDefault();\r\n\r\n    const enteredPrice = web3.utils.toWei(priceRefs.current[key].current.value, 'ether');\r\n\r\n    collectionCtx.contract.methods.approve(marketplaceCtx.contract.options.address, id).send({ from: web3Ctx.account })\r\n    .on('transactionHash', (hash) => {\r\n      marketplaceCtx.setMktIsLoading(true);\r\n    })\r\n    .on('receipt', (receipt) => {      \r\n      marketplaceCtx.contract.methods.makeOffer(id, enteredPrice).send({ from: web3Ctx.account })\r\n      .on('error', (error) => {\r\n        window.alert('Something went wrong when pushing to the blockchain');\r\n        marketplaceCtx.setMktIsLoading(false);\r\n      }); \r\n    });\r\n  };\r\n  \r\n  const buyHandler = (event) => {    \r\n    const buyIndex = parseInt(event.target.value);      \r\n    marketplaceCtx.contract.methods.fillOffer(marketplaceCtx.offers[buyIndex].offerId).send({ from: web3Ctx.account, value: marketplaceCtx.offers[buyIndex].price })\r\n    .on('transactionHash', (hash) => {\r\n      marketplaceCtx.setMktIsLoading(true);\r\n    })\r\n    .on('error', (error) => {\r\n      window.alert('Something went wrong when pushing to the blockchain');\r\n      marketplaceCtx.setMktIsLoading(false);\r\n    });            \r\n  };\r\n\r\n  const cancelHandler = (event) => {    \r\n    const cancelIndex = parseInt(event.target.value);\r\n    marketplaceCtx.contract.methods.cancelOffer(marketplaceCtx.offers[cancelIndex].offerId).send({ from: web3Ctx.account })\r\n    .on('transactionHash', (hash) => {\r\n      marketplaceCtx.setMktIsLoading(true);\r\n    })\r\n    .on('error', (error) => {\r\n      window.alert('Something went wrong when pushing to the blockchain');\r\n      marketplaceCtx.setMktIsLoading(false);\r\n    });    \r\n  };\r\n \r\n  return(\r\n    <div className=\"row text-center\">\r\n      {collectionCtx.collection.map((NFT, key) => {\r\n        const index = marketplaceCtx.offers ? marketplaceCtx.offers.findIndex(offer => offer.id === NFT.id) : -1;\r\n        const owner = index === -1 ? NFT.owner : marketplaceCtx.offers[index].user;\r\n        const price = index !== -1 ? formatPrice(marketplaceCtx.offers[index].price).toFixed(2) : null;\r\n\r\n        return(\r\n          <div key={key} className=\"col-md-2 m-3 pb-3 card border-info\">\r\n            <div className={\"card-body\"}>       \r\n              <h5 className=\"card-title\">{NFT.title}</h5>\r\n            </div>\r\n            <img src={`https://ipfs.infura.io/ipfs/${NFT.img}`} className=\"card-img-bottom\" alt={`NFT ${key}`} />                         \r\n            <p className=\"fw-light fs-6\">{`${owner.substr(0,7)}...${owner.substr(owner.length - 7)}`}</p>\r\n            {index !== -1 ?\r\n              owner !== web3Ctx.account ?\r\n                <div className=\"row\">\r\n                  <div className=\"d-grid gap-2 col-5 mx-auto\">\r\n                    <button onClick={buyHandler} value={index} className=\"btn btn-success\">BUY</button>\r\n                  </div>\r\n                  <div className=\"col-7 d-flex justify-content-end\">\r\n                    <img src={eth} width=\"25\" height=\"25\" className=\"align-center float-start\" alt=\"price icon\"></img>                \r\n                    <p className=\"text-start\"><b>{`${price}`}</b></p>\r\n                  </div>\r\n                </div> :\r\n                <div className=\"row\">\r\n                  <div className=\"d-grid gap-2 col-5 mx-auto\">\r\n                    <button onClick={cancelHandler} value={index} className=\"btn btn-danger\">CANCEL</button>\r\n                  </div>\r\n                  <div className=\"col-7 d-flex justify-content-end\">\r\n                    <img src={eth} width=\"25\" height=\"25\" className=\"align-center float-start\" alt=\"price icon\"></img>                \r\n                    <p className=\"text-start\"><b>{`${price}`}</b></p>\r\n                  </div>\r\n                </div> :\r\n              owner === web3Ctx.account ?              \r\n                <form className=\"row g-2\" onSubmit={(e) => makeOfferHandler(e, NFT.id, key)}>                \r\n                  <div className=\"col-5 d-grid gap-2\">\r\n                    <button type=\"submit\" className=\"btn btn-secondary\">OFFER</button>\r\n                  </div>\r\n                  <div className=\"col-7\">\r\n                    <input\r\n                      type=\"number\"\r\n                      step=\"0.01\"\r\n                      placeholder=\"ETH...\"\r\n                      className=\"form-control\"\r\n                      ref={priceRefs.current[key]}\r\n                    />\r\n                  </div>                                  \r\n                </form> :\r\n                <p><br/></p>}\r\n          </div>\r\n        );\r\n      })}\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default NFTCollection;"]},"metadata":{},"sourceType":"module"}